[
  {
    "objectID": "notebooks/report.html",
    "href": "notebooks/report.html",
    "title": "Nurse staffing strategies for enhanced patient care",
    "section": "",
    "text": "[…]"
  },
  {
    "objectID": "notebooks/report.html#imports",
    "href": "notebooks/report.html#imports",
    "title": "Nurse staffing strategies for enhanced patient care",
    "section": "Imports",
    "text": "Imports\n\n\nCode\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\nfrom great_tables import GT\nfrom pandas.plotting import scatter_matrix\n\nfrom src.stylesheet import customize_plots\nfrom src.inspection import make_df, display, display2"
  },
  {
    "objectID": "notebooks/report.html#the-dataset",
    "href": "notebooks/report.html#the-dataset",
    "title": "Nurse staffing strategies for enhanced patient care",
    "section": "The dataset",
    "text": "The dataset\n\nLoad the data\nWe begin by exploring the data to get to know the features and patterns on which we will base our analysis.\n\n\nCode\nif 'data' not in locals():\n    data = pd.read_csv(\n        \"../data/raw/PBJ_Daily_Nurse_Staffing_Q1_2024.zip\",\n        encoding='ISO-8859-1',\n        low_memory=False\n    )\nelse:\n    print(\"data loaded.\")\n\n\n\n\nInspect the data\n\n\nCode\nGT(data.sample(10))\n\n\n\n\n\n\n\n\n  PROVNUM\n  PROVNAME\n  CITY\n  STATE\n  COUNTY_NAME\n  COUNTY_FIPS\n  CY_Qtr\n  WorkDate\n  MDScensus\n  Hrs_RNDON\n  Hrs_RNDON_emp\n  Hrs_RNDON_ctr\n  Hrs_RNadmin\n  Hrs_RNadmin_emp\n  Hrs_RNadmin_ctr\n  Hrs_RN\n  Hrs_RN_emp\n  Hrs_RN_ctr\n  Hrs_LPNadmin\n  Hrs_LPNadmin_emp\n  Hrs_LPNadmin_ctr\n  Hrs_LPN\n  Hrs_LPN_emp\n  Hrs_LPN_ctr\n  Hrs_CNA\n  Hrs_CNA_emp\n  Hrs_CNA_ctr\n  Hrs_NAtrn\n  Hrs_NAtrn_emp\n  Hrs_NAtrn_ctr\n  Hrs_MedAide\n  Hrs_MedAide_emp\n  Hrs_MedAide_ctr\n\n\n\n  \n    475003\n    BIRCHWOOD TERRACE REHAB & HEALTHCARE\n    BURLINGTON\n    VT\n    Chittenden\n    7\n    2024Q1\n    20240305\n    127\n    7.5\n    7.5\n    0.0\n    0.0\n    0.0\n    0.0\n    65.0\n    57.0\n    8.0\n    0.0\n    0.0\n    0.0\n    146.0\n    76.0\n    70.0\n    265.75\n    177.0\n    88.75\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n  \n  \n    675748\n    HERITAGE TRAILS NURSING AND REHABILITATION CENTER\n    CLEBURNE\n    TX\n    Johnson\n    251\n    2024Q1\n    20240314\n    90\n    0.0\n    0.0\n    0.0\n    8.0\n    8.0\n    0.0\n    25.48\n    25.48\n    0.0\n    24.47\n    24.47\n    0.0\n    74.05\n    65.7\n    8.35\n    131.15\n    107.61\n    23.54\n    0.0\n    0.0\n    0.0\n    29.89\n    29.89\n    0.0\n  \n  \n    675075\n    DIVERSICARE OF LULING\n    LULING\n    TX\n    Caldwell\n    55\n    2024Q1\n    20240325\n    38\n    8.0\n    8.0\n    0.0\n    8.0\n    8.0\n    0.0\n    9.43\n    9.43\n    0.0\n    0.0\n    0.0\n    0.0\n    22.91\n    22.91\n    0.0\n    41.24\n    41.24\n    0.0\n    11.68\n    11.68\n    0.0\n    11.42\n    11.42\n    0.0\n  \n  \n    555354\n    DELTA HEALTHCARE & WELLNESS CENTER, LP\n    VISALIA\n    CA\n    Tulare\n    107\n    2024Q1\n    20240329\n    40\n    8.0\n    8.0\n    0.0\n    8.0\n    8.0\n    0.0\n    0.0\n    0.0\n    0.0\n    8.82\n    8.82\n    0.0\n    42.13\n    42.13\n    0.0\n    95.17\n    95.17\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n  \n  \n    29E037\n    MISSION PINES NURSING AND REHAB CENTER\n    NORTH LAS VEGAS\n    NV\n    Clark\n    3\n    2024Q1\n    20240103\n    171\n    8.0\n    8.0\n    0.0\n    0.0\n    0.0\n    0.0\n    70.39\n    70.39\n    0.0\n    0.0\n    0.0\n    0.0\n    107.14\n    107.14\n    0.0\n    398.91\n    398.91\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n  \n  \n    515170\n    SUMMERS HEALTHCARE CENTER\n    HINTON\n    WV\n    Summers\n    89\n    2024Q1\n    20240304\n    109\n    8.0\n    8.0\n    0.0\n    24.25\n    24.25\n    0.0\n    18.5\n    18.5\n    0.0\n    0.0\n    0.0\n    0.0\n    98.25\n    98.25\n    0.0\n    219.5\n    219.5\n    0.0\n    13.0\n    13.0\n    0.0\n    0.0\n    0.0\n    0.0\n  \n  \n    305061\n    CRESTWOOD CENTER\n    MILFORD\n    NH\n    Hillsborough\n    11\n    2024Q1\n    20240216\n    66\n    8.0\n    8.0\n    0.0\n    0.0\n    0.0\n    0.0\n    18.31\n    18.31\n    0.0\n    8.0\n    8.0\n    0.0\n    63.66\n    46.22\n    17.44\n    109.16\n    101.17\n    7.99\n    3.53\n    3.53\n    0.0\n    20.24\n    20.24\n    0.0\n  \n  \n    345552\n    THE SHANNON GRAY REHABILITATION & RECOVERY CENTER\n    JAMESTOWN\n    NC\n    Guilford\n    81\n    2024Q1\n    20240113\n    110\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    31.0\n    31.0\n    0.0\n    0.0\n    0.0\n    0.0\n    98.0\n    98.0\n    0.0\n    259.25\n    259.25\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n  \n  \n    395286\n    BROAD MOUNTAIN HEALTH AND REHABILITATION CENTER\n    FRACKVILLE\n    PA\n    Schuylkill\n    107\n    2024Q1\n    20240203\n    89\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    17.0\n    17.0\n    0.0\n    0.0\n    0.0\n    0.0\n    76.82\n    60.5\n    16.32\n    177.25\n    130.0\n    47.25\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n  \n  \n    255268\n    NEW ALBANY HEALTH & REHAB CENTER\n    NEW ALBANY\n    MS\n    Union\n    145\n    2024Q1\n    20240217\n    91\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    8.25\n    8.25\n    0.0\n    0.0\n    0.0\n    0.0\n    86.5\n    86.5\n    0.0\n    162.5\n    162.5\n    0.0\n    35.25\n    35.25\n    0.0\n    0.0\n    0.0\n    0.0\n  \n\n\n\n\n\n\n        \n\n\n\n\nCode\ndf = data.describe().round(1)\n# display(Markdown(df.to_markdown()))\nGT(df.reset_index())\n\n\n\n\n\n\n\n\n  index\n  COUNTY_FIPS\n  WorkDate\n  MDScensus\n  Hrs_RNDON\n  Hrs_RNDON_emp\n  Hrs_RNDON_ctr\n  Hrs_RNadmin\n  Hrs_RNadmin_emp\n  Hrs_RNadmin_ctr\n  Hrs_RN\n  Hrs_RN_emp\n  Hrs_RN_ctr\n  Hrs_LPNadmin\n  Hrs_LPNadmin_emp\n  Hrs_LPNadmin_ctr\n  Hrs_LPN\n  Hrs_LPN_emp\n  Hrs_LPN_ctr\n  Hrs_CNA\n  Hrs_CNA_emp\n  Hrs_CNA_ctr\n  Hrs_NAtrn\n  Hrs_NAtrn_emp\n  Hrs_NAtrn_ctr\n  Hrs_MedAide\n  Hrs_MedAide_emp\n  Hrs_MedAide_ctr\n\n\n\n  \n    count\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n    1330966.0\n  \n  \n    mean\n    91.1\n    20240215.7\n    83.4\n    5.2\n    5.1\n    0.1\n    10.3\n    10.0\n    0.2\n    34.4\n    31.5\n    3.0\n    6.6\n    6.6\n    0.1\n    66.3\n    59.8\n    6.5\n    171.2\n    158.2\n    13.0\n    4.2\n    4.2\n    0.1\n    8.5\n    8.3\n    0.2\n  \n  \n    std\n    99.2\n    83.0\n    49.1\n    4.5\n    4.5\n    0.9\n    14.9\n    14.6\n    1.8\n    34.7\n    31.4\n    10.7\n    10.7\n    10.6\n    1.3\n    48.4\n    44.8\n    16.2\n    113.7\n    106.3\n    32.6\n    13.1\n    12.7\n    2.1\n    17.6\n    17.2\n    2.2\n  \n  \n    min\n    1.0\n    20240101.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n  \n  \n    25%\n    31.0\n    20240123.0\n    51.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    13.0\n    12.0\n    0.0\n    0.0\n    0.0\n    0.0\n    32.8\n    28.2\n    0.0\n    97.0\n    88.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n  \n  \n    50%\n    69.0\n    20240215.0\n    76.0\n    8.0\n    8.0\n    0.0\n    7.5\n    7.4\n    0.0\n    25.6\n    24.2\n    0.0\n    0.0\n    0.0\n    0.0\n    56.9\n    50.8\n    0.0\n    148.1\n    136.8\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n    0.0\n  \n  \n    75%\n    117.0\n    20240309.0\n    104.0\n    8.0\n    8.0\n    0.0\n    16.0\n    16.0\n    0.0\n    44.8\n    41.5\n    0.0\n    9.0\n    8.8\n    0.0\n    88.6\n    81.2\n    5.8\n    217.0\n    203.1\n    11.0\n    0.0\n    0.0\n    0.0\n    11.2\n    10.8\n    0.0\n  \n  \n    max\n    840.0\n    20240331.0\n    743.0\n    327.8\n    327.8\n    42.0\n    266.2\n    266.2\n    92.5\n    908.6\n    904.2\n    430.6\n    246.8\n    246.8\n    154.4\n    614.6\n    604.0\n    454.0\n    1857.7\n    1573.1\n    694.3\n    452.0\n    279.0\n    280.5\n    395.6\n    395.6\n    128.9\n  \n\n\n\n\n\n\n        \n\n\n\n\nGroup the features\nWe note that there are 91 records per provider (len(data[\"WorkDate\"].unique())) and 1,330,966 records in the table overall. The following table, which collapses the raw data across providers, thus has 14,626 \\(\\left( \\frac{1330966}{91} \\right)\\) entries.\n\n\nCode\ndf = data.loc[:, [\n    \"STATE\",\n    \"COUNTY_NAME\", \"COUNTY_FIPS\",\n    \"CITY\",\n    \"PROVNAME\", \"PROVNUM\",\n    # \"MDScensus\"\n]].value_counts()\n# df.to_frame()\nGT(df.reset_index().head(n=20))\n\n\n\n\n\n\n\n\n  STATE\n  COUNTY_NAME\n  COUNTY_FIPS\n  CITY\n  PROVNAME\n  PROVNUM\n  count\n\n\n\n  \n    AK\n    Anchorage\n    20\n    ANCHORAGE\n    PRESTIGE CARE & REHAB CENTER OF ANCHORAGE\n    025025\n    91\n  \n  \n    OH\n    Allen\n    3\n    LIMA\n    LIMA CONVALESCENT HOME\n    366297\n    91\n  \n  \n    OH\n    Allen\n    3\n    LIMA\n    SHAWNEE MANOR\n    365361\n    91\n  \n  \n    OH\n    Allen\n    3\n    LIMA\n    SPRINGS OF LIMA THE\n    366464\n    91\n  \n  \n    OH\n    Allen\n    3\n    LIMA\n    SPRINGVIEW MANOR\n    366221\n    91\n  \n  \n    OH\n    Allen\n    3\n    SPENCERVILLE\n    ROSELAWN MANOR\n    365744\n    91\n  \n  \n    OH\n    Ashland\n    5\n    ASHLAND\n    BRETHREN CARE VILLAGE HEALTH CARE CENTER\n    366166\n    91\n  \n  \n    OH\n    Ashland\n    5\n    ASHLAND\n    CRYSTAL CARE CENTER OF ASHLAND\n    366239\n    91\n  \n  \n    OH\n    Ashland\n    5\n    ASHLAND\n    GOOD SHEPHERD THE\n    365093\n    91\n  \n  \n    OH\n    Ashland\n    5\n    ASHLAND\n    KINGSTON OF ASHLAND\n    365646\n    91\n  \n  \n    OH\n    Ashtabula\n    7\n    ANDOVER\n    ANDOVER VILLAGE RETIREMENT COMMUNITY\n    365411\n    91\n  \n  \n    OH\n    Ashtabula\n    7\n    ASHTABULA\n    CARINGTON PARK\n    365286\n    91\n  \n  \n    OH\n    Ashtabula\n    7\n    ASHTABULA\n    COUNTRY CLUB RET CENTER I I I\n    365642\n    91\n  \n  \n    OH\n    Ashtabula\n    7\n    ASHTABULA\n    SAYBROOK LANDING\n    366382\n    91\n  \n  \n    OH\n    Ashtabula\n    7\n    AUSTINBURG\n    AUSTINBURG NSG AND  REHAB CTR\n    366088\n    91\n  \n  \n    OH\n    Ashtabula\n    7\n    CONNEAUT\n    LAKE POINTE REHABILITATION AND NURSING CENTER\n    365441\n    91\n  \n  \n    OH\n    Ashtabula\n    7\n    GENEVA\n    GENEVA CENTER FOR REHABILITATION AND NURSING\n    366326\n    91\n  \n  \n    OH\n    Ashtabula\n    7\n    GENEVA\n    PINE GROVE HEALTHCARE CENTER\n    366366\n    91\n  \n  \n    OH\n    Ashtabula\n    7\n    GENEVA\n    RAE ANN GENEVA\n    366047\n    91\n  \n  \n    OH\n    Ashtabula\n    7\n    JEFFERSON\n    JEFFERSON HEALTHCARE CENTER\n    365638\n    91\n  \n\n\n\n\n\n\n        \n\n\n\n\nCode\nGT(data[[\"CY_Qtr\", \"WorkDate\", \"MDScensus\"]].head())\n\n\n\n\n\n\n\n\n  CY_Qtr\n  WorkDate\n  MDScensus\n\n\n\n  \n    2024Q1\n    20240101\n    50\n  \n  \n    2024Q1\n    20240102\n    49\n  \n  \n    2024Q1\n    20240103\n    49\n  \n  \n    2024Q1\n    20240104\n    50\n  \n  \n    2024Q1\n    20240105\n    51\n  \n\n\n\n\n\n\n        \n\n\n\n\nClean the data"
  },
  {
    "objectID": "notebooks/report.html#explore-the-dataset",
    "href": "notebooks/report.html#explore-the-dataset",
    "title": "Nurse staffing strategies for enhanced patient care",
    "section": "Explore the dataset",
    "text": "Explore the dataset\n\nVisualize distributions\n\n\nVisualize relationships\n\n\nCode\nattributes = [\"Hrs_RN\", \"Hrs_LPN_ctr\", \"Hrs_CNA\", \"Hrs_NAtrn\", \"Hrs_MedAide\"]\nn = len(attributes)\n\nfig, axs = plt.subplots(n, n, figsize=(8, 8))\nscatter_matrix(\n    data[attributes].sample(200),\n    ax=axs, alpha=.7,\n    hist_kwds=dict(bins=15, linewidth=0)\n)\nfig.align_ylabels(axs[:, 0])\nfig.align_xlabels(axs[-1, :])\nfor ax in axs.flatten():\n    ax.tick_params(axis='both', which='both', length=3.5)\n\n# save_fig(\"scatter_matrix_plot\")\n\nplt.show()\n\n\n\n\n\n\n\n\nFigure 1: Scatter matrix of nursing worker working hours\n\n\n\n\n\n\n\nCompare groups"
  },
  {
    "objectID": "notebooks/report.html#feature-engineer",
    "href": "notebooks/report.html#feature-engineer",
    "title": "Nurse staffing strategies for enhanced patient care",
    "section": "Feature engineer",
    "text": "Feature engineer\n\nJoin geographical data\n\n\nJoin seasonal data"
  },
  {
    "objectID": "notebooks/report.html#analyze-geography",
    "href": "notebooks/report.html#analyze-geography",
    "title": "Nurse staffing strategies for enhanced patient care",
    "section": "Analyze geography",
    "text": "Analyze geography"
  },
  {
    "objectID": "notebooks/report.html#analyze-seasonality",
    "href": "notebooks/report.html#analyze-seasonality",
    "title": "Nurse staffing strategies for enhanced patient care",
    "section": "Analyze seasonality",
    "text": "Analyze seasonality"
  },
  {
    "objectID": "notebooks/report.html#model",
    "href": "notebooks/report.html#model",
    "title": "Nurse staffing strategies for enhanced patient care",
    "section": "Model",
    "text": "Model"
  },
  {
    "objectID": "notebooks/report.html#extra-visualizations",
    "href": "notebooks/report.html#extra-visualizations",
    "title": "Nurse staffing strategies for enhanced patient care",
    "section": "Extra visualizations",
    "text": "Extra visualizations\n\nSparklines\n\n\nCode\n# Plot sparklines of average work hours across 91 days by state\n(\n    GT(gt_df.head(), rowname_col=\"STATE\")\n    .fmt_nanoplot(\n        columns=\"lines\",\n        reference_line=\"mean\",\n        reference_area=[\"min\", \"q1\"]\n    )\n    .tab_header(\n        title=\"Nurse hours worked in the United States\",\n        subtitle=\"The top 5 busiest states\",\n    )\n    .tab_stubhead(label=\"State\")\n    .cols_label(\n        lines=\"Total hours worked over 91 days\",\n    )\n)\n\n\n\n\n\n\n\n\n\n  \n    Nurse hours worked in the United States\n  \n  \n    The top 5 busiest states\n  \n\n  State\n  Total hours worked over 91 days\n\n\n\n  \n    AK\n    2.71K3.00K2.12K2.21K2.71K2.76K2.84K2.75K2.36K2.24K2.89K2.92K2.87K2.87K2.86K2.33K2.21K2.77K2.88K2.95K2.96K2.86K2.24K2.12K2.76K2.91K2.95K2.93K2.87K2.36K2.20K2.81K2.89K2.95K3.00K2.84K2.39K2.31K2.74K2.93K2.91K2.94K2.84K2.42K2.21K2.70K2.87K2.88K2.83K2.76K2.39K2.25K2.70K2.92K2.92K2.92K2.83K2.48K2.32K2.81K2.89K3.00K2.91K2.86K2.46K2.38K2.90K2.92K2.98K2.92K2.91K2.51K2.39K2.85K2.94K2.80K2.87K2.84K2.46K2.38K2.91K2.91K2.98K2.97K2.89K2.47K2.37K2.88K2.88K2.89K2.90K2.80K2.36K2.24K\n  \n  \n    AL\n    56.9K63.5K44.3K48.1K58.7K61.4K61.4K58.9K48.1K47.4K57.9K59.2K62.6K61.9K59.3K48.2K47.8K58.7K56.2K59.3K60.2K59.0K47.9K46.9K59.6K61.6K62.5K62.2K60.0K48.0K47.7K60.4K62.6K63.4K62.0K60.3K48.5K47.7K60.9K63.1K63.3K62.8K60.5K48.4K46.8K58.7K61.3K60.9K61.5K59.2K47.1K46.6K59.3K62.0K62.7K61.9K59.2K46.9K46.4K60.1K62.1K62.7K62.7K58.6K46.8K46.6K60.3K62.1K62.8K62.7K60.0K47.9K45.4K59.6K62.0K63.1K62.4K60.0K46.8K46.3K59.9K62.7K63.5K62.8K59.9K48.0K47.0K59.6K61.9K63.4K62.0K58.3K46.4K44.3K\n  \n  \n    AR\n    48.1K54.0K37.7K42.3K51.4K53.1K53.0K50.6K41.0K39.9K50.9K52.9K53.5K53.1K51.3K40.9K39.3K46.2K49.2K52.0K51.4K51.4K41.0K39.5K47.9K52.2K53.1K53.0K51.8K40.2K39.1K50.8K52.5K53.5K53.0K51.5K40.6K39.4K51.0K52.8K53.2K52.5K51.2K39.7K38.3K50.0K52.7K52.2K51.5K50.3K39.8K38.0K49.9K51.9K52.3K51.5K50.2K38.9K38.5K49.9K52.1K53.1K51.9K50.6K39.8K38.1K50.5K52.3K53.3K51.9K50.5K40.0K38.0K50.6K52.7K53.5K52.4K50.8K40.0K39.0K50.4K52.6K52.7K52.0K49.6K39.6K38.7K50.3K53.1K54.0K53.5K51.5K39.9K37.7K\n  \n  \n    AZ\n    29.0K31.5K23.1K25.3K29.7K30.9K31.0K30.5K25.0K24.1K30.2K30.9K31.3K31.1K30.6K25.2K24.5K30.0K30.4K31.0K30.8K30.4K24.8K24.4K30.0K30.9K31.2K30.8K30.5K25.5K24.8K30.5K31.2K31.4K31.5K30.5K25.3K24.8K30.7K31.3K31.5K31.5K30.8K25.4K24.7K30.3K31.3K31.0K31.0K30.6K25.0K24.4K30.1K31.3K31.3K31.4K30.7K25.3K24.5K30.3K31.0K31.3K31.2K30.0K25.0K24.3K30.1K31.0K31.4K31.0K30.3K25.2K24.8K30.3K30.9K31.1K31.0K30.5K25.0K24.2K29.8K30.6K30.9K31.0K30.7K25.3K24.3K30.4K30.8K31.1K31.0K30.3K24.7K23.1K\n  \n  \n    CA\n    271K287K237K241K273K278K281K278K244K240K274K283K283K284K280K246K244K276K282K284K284K281K247K244K276K285K286K285K282K248K244K279K286K287K283K281K249K244K276K284K286K285K282K249K242K277K283K281K284K281K247K243K273K284K285K286K283K247K244K279K286K287K287K282K248K245K279K286K286K286K282K248K240K279K285K286K286K282K245K242K277K285K285K285K281K246K244K278K284K286K286K280K247K237K\n  \n\n\n\n\n\n\n        \n\n\nFigure 2: Sparklines of average work hours across 91 days by state."
  },
  {
    "objectID": "notebooks/report.html#archive",
    "href": "notebooks/report.html#archive",
    "title": "Nurse staffing strategies for enhanced patient care",
    "section": "Archive",
    "text": "Archive"
  },
  {
    "objectID": "notebooks/sql_qs.html",
    "href": "notebooks/sql_qs.html",
    "title": "Exploring a database with SQL",
    "section": "",
    "text": "Code\nimport sqlite3\nimport pandas as pd\nfrom IPython.display import Markdown, display"
  },
  {
    "objectID": "notebooks/sql_qs.html#imports",
    "href": "notebooks/sql_qs.html#imports",
    "title": "Exploring a database with SQL",
    "section": "",
    "text": "Code\nimport sqlite3\nimport pandas as pd\nfrom IPython.display import Markdown, display"
  },
  {
    "objectID": "notebooks/sql_qs.html#sql",
    "href": "notebooks/sql_qs.html#sql",
    "title": "Exploring a database with SQL",
    "section": "SQL",
    "text": "SQL\nLet us imagine we have the following tables in our database:\n\nSales\n\n\nsales_id (INT)\ncustomer_id (INT)\nproduct_id (INT)\nsale_date (DATE)\nquantity (INT)\ntotal_amount (DECIMAL)\n\n\nCustomers\n\n\ncustomer_id (INT)\ncustomer_name (VARCHAR)\nsales_region (VARCHAR)\nsign_up_date (DATE)\n\n\nProducts\n\n\nproduct_id (INT)\nproduct_name (VARCHAR)\ncategory (VARCHAR)\nprice (DECIMAL)\n\nWe can simulate this problem by creating a test database in Python and adding tables to it that match this description.\n\n\nCreate a database\n# Create a database and cursor to query it\nconn = sqlite3.connect(\"testdatabase.db\", timeout=10.0)\ncursor = conn.cursor()\n\n\n\n\nCreate the tables\n# Create `Sales` table\ncursor.execute(\n    \"\"\"\n    CREATE TABLE IF NOT EXISTS Sales\n    (\n        sales_id INTEGER PRIMARY KEY AUTOINCREMENT,\n        customer_id INTEGER,\n        product_id INTEGER,\n        sales_date DATE,\n        quantity INTEGER,\n        total_amount DECIMAL(10, 2),\n        FOREIGN KEY (customer_id) REFERENCES Customers(customer_id),\n        FOREIGN KEY (product_id) REFERENCES Products(product_id)\n    )\n    \"\"\"\n)\n\n# Create `Customers` table\ncursor.execute(\n    \"\"\"\n    CREATE TABLE IF NOT EXISTS Customers\n    (\n        customer_id INTEGER PRIMARY KEY AUTOINCREMENT,\n        customer_name VARCHAR(255) NOT NULL,\n        sales_region VARCHAR(255),\n        sign_up_date DATE\n    )\n    \"\"\"\n)\n\n# Create `Products` table\ncursor.execute(\n    \"\"\"\n    CREATE TABLE IF NOT EXISTS Products\n    (\n        product_id INTEGER PRIMARY KEY AUTOINCREMENT,\n        product_name VARCHAR(255) NOT NULL,\n        category VARCHAR(255),\n        price DECIMAL(10, 2)\n    )\n    \"\"\"\n)\n\n\n&lt;sqlite3.Cursor at 0x127d3b3c0&gt;\n\n\n\n\nInsert example data\n# Insert record into `Customers` table\nquery = \"\"\"\n    INSERT INTO Customers\n    (customer_name, sales_region, sign_up_date)\n    VALUES (?, ?, ?)\n\"\"\"\nvalues = [\n    (\"John Doe\", \"West\", \"2023-09-25\"),\n    (\"Jane Young\", \"South\", \"2024-09-25\"),\n    (\"Chris Nguyen\", \"West\", \"2024-09-25\"),\n]\ncursor.executemany(query, values)\n\n# Insert record into `Products` table\nquery = \"\"\"\n    INSERT INTO Products\n    (product_name, category, price)\n    VALUES (?, ?, ?)\n\"\"\"\nvalues = [\n    (\"Washing machine\", \"Appliances\", 1500.00),\n    (\"Laptop\", \"Electronics\", 1000.00),\n    (\"Phone\", \"Electronics\", 800.00),\n]\ncursor.executemany(query, values)\n\n# Insert record into `Sales` table\nquery = \"\"\"\n    INSERT INTO Sales\n    (customer_id, product_id, sales_date, quantity, total_amount)\n    VALUES (?, ?, ?, ?, ?)\n\"\"\"\nvalues = [\n    (1, 1, \"2023-09-26\", 2, values[0][2] * 2),\n    (2, 1, \"2023-01-15\", 4, values[0][2] * 4),\n    (2, 2, \"2024-09-20\", 3, values[1][2] * 3),\n    (3, 3, \"2024-09-22\", 9, values[2][2] * 9),\n    (1, 2, \"2023-09-26\", 5, values[1][2] * 5),\n]\ncursor.executemany(query, values)\n\n\n&lt;sqlite3.Cursor at 0x127d3b3c0&gt;\n\n\n\n\nCheck the contents of the tables\n# Query `Sales`\nquery = \"\"\"\n    SELECT *\n    FROM Sales\n    LIMIT 5;\n\"\"\"\ndisplay(Markdown(\"**`Sales`**:\"), pd.read_sql(query, conn))\n\n# Query `Customers`\nquery = \"\"\"\n    SELECT *\n    FROM Customers\n    LIMIT 5;\n\"\"\"\ndisplay(Markdown(\"**`Customers`**:\"), pd.read_sql(query, conn))\n\n# Query `Products`\nquery = \"\"\"\n    SELECT *\n    FROM Products\n    LIMIT 5;\n\"\"\"\ndisplay(Markdown(\"**`Products`**:\"), pd.read_sql(query, conn))\n\n\nSales:\n\n\n\n\n\n  \n    \n      \n      sales_id\n      customer_id\n      product_id\n      sales_date\n      quantity\n      total_amount\n    \n  \n  \n    \n      0\n      1\n      1\n      1\n      2023-09-26\n      2\n      3000\n    \n    \n      1\n      2\n      2\n      1\n      2023-01-15\n      4\n      6000\n    \n    \n      2\n      3\n      2\n      2\n      2024-09-20\n      3\n      3000\n    \n    \n      3\n      4\n      3\n      3\n      2024-09-22\n      9\n      7200\n    \n    \n      4\n      5\n      1\n      2\n      2023-09-26\n      5\n      5000\n    \n  \n\n\n\n\nCustomers:\n\n\n\n\n\n  \n    \n      \n      customer_id\n      customer_name\n      sales_region\n      sign_up_date\n    \n  \n  \n    \n      0\n      1\n      John Doe\n      West\n      2023-09-25\n    \n    \n      1\n      2\n      Jane Young\n      South\n      2024-09-25\n    \n    \n      2\n      3\n      Chris Nguyen\n      West\n      2024-09-25\n    \n  \n\n\n\n\nProducts:\n\n\n\n\n\n  \n    \n      \n      product_id\n      product_name\n      category\n      price\n    \n  \n  \n    \n      0\n      1\n      Washing machine\n      Appliances\n      1500\n    \n    \n      1\n      2\n      Laptop\n      Electronics\n      1000\n    \n    \n      2\n      3\n      Phone\n      Electronics\n      800\n    \n  \n\n\n\n\n\nQ1\nWrite a query to return the customer_name, product_name, and total_amount for each sale in the last 30 days.\n\n\nCode\nquery = \"\"\"\n    SELECT\n        Customers.customer_name,\n        Products.product_name,\n        Sales.total_amount\n    FROM\n        Sales\n    LEFT JOIN Customers\n        ON Sales.customer_id = Customers.customer_id\n    LEFT JOIN Products\n        ON Sales.product_id = Products.product_id\n    WHERE\n        Sales.sales_date &gt;= DATE('now', '-30 days');\n\"\"\"\npd.read_sql(query, conn)\n\n\n\n\n\n  \n    \n      \n      customer_name\n      product_name\n      total_amount\n    \n  \n  \n    \n      0\n      Jane Young\n      Laptop\n      3000\n    \n    \n      1\n      Chris Nguyen\n      Phone\n      7200\n    \n  \n\n\n\n\n\n\nQ2\nWrite a query to find the total revenue generated by each product category in the last year. The output should include the product category and the total revenue for that category.\n\n\nCode\nquery = \"\"\"\n    SELECT\n        Products.category,\n        SUM(Sales.total_amount) AS total_revenue\n    FROM\n        Sales\n    LEFT JOIN Products\n        ON Sales.product_id = Products.product_id\n    WHERE\n        Sales.sales_date &gt;= DATE('now', '-1 year')\n    GROUP BY\n        category;\n\"\"\"\npd.read_sql(query, conn)\n\n\n\n\n\n  \n    \n      \n      category\n      total_revenue\n    \n  \n  \n    \n      0\n      Electronics\n      10200\n    \n  \n\n\n\n\n\n\nQ3\nWrite a query to return all customers who made purchases in 2023 and are located in the “West” region.\n\n\nCode\nquery = \"\"\"\n    SELECT DISTINCT\n        Customers.customer_name\n    FROM\n        Customers\n    INNER JOIN Sales\n        ON Customers.customer_id = Sales.customer_id\n    WHERE\n        strftime('%Y', Sales.sales_date) = '2023'\n        AND Customers.sales_region = 'West'\n\"\"\"\npd.read_sql(query, conn)\n\n\n\n\n\n  \n    \n      \n      customer_name\n    \n  \n  \n    \n      0\n      John Doe\n    \n  \n\n\n\n\n\n\nQ4\nWrite a query to display the total number of sales, total quantity sold, and total revenue for each customer. The result should include the customer_name, total sales, total quantity, and total revenue.\n\n\nCode\nquery = \"\"\"\n    SELECT\n        Customers.customer_name,\n        COUNT(Sales.sales_id) AS total_sales,\n        SUM(Sales.quantity) AS total_quantity,\n        SUM(Sales.total_amount) AS total_revenue\n    FROM\n        Customers\n    LEFT JOIN Sales\n        ON Sales.customer_id = Customers.customer_id\n    GROUP BY\n        Customers.customer_id;\n\"\"\"\npd.read_sql(query, conn)\n\n\n\n\n\n  \n    \n      \n      customer_name\n      total_sales\n      total_quantity\n      total_revenue\n    \n  \n  \n    \n      0\n      John Doe\n      2\n      7\n      8000\n    \n    \n      1\n      Jane Young\n      2\n      7\n      9000\n    \n    \n      2\n      Chris Nguyen\n      1\n      9\n      7200\n    \n  \n\n\n\n\n\n\nQ5\nWrite a query to find the top 3 customers (by total revenue) in the year 2023.\n\n\nCode\nquery = \"\"\"\n    SELECT\n        Customers.customer_name,\n        SUM(Sales.total_amount) AS total_revenue\n    FROM\n        Customers\n    LEFT JOIN Sales\n        ON Customers.customer_id = Sales.customer_id\n        AND strftime('%Y', Sales.sales_date) = '2023'\n    GROUP BY\n        Customers.customer_name\n    ORDER BY\n        total_revenue DESC;\n\"\"\"\npd.read_sql(query, conn)\n\n\n\n\n\n  \n    \n      \n      customer_name\n      total_revenue\n    \n  \n  \n    \n      0\n      John Doe\n      8000.0\n    \n    \n      1\n      Jane Young\n      6000.0\n    \n    \n      2\n      Chris Nguyen\n      NaN\n    \n  \n\n\n\n\n\n\nQ6\nWrite a query to rank products by their total sales quantity in 2023. The result should include the product_name, total quantity sold, and rank.\n\n\nCode\nquery = \"\"\"\n    SELECT\n        Products.product_name,\n        SUM(Sales.quantity) AS total_quantity,\n        RANK() OVER\n            (ORDER BY SUM(Sales.quantity) DESC) AS quantity_rank\n    FROM\n        Products\n    LEFT JOIN Sales\n        ON Products.product_id = Sales.product_id\n        AND strftime('%Y', Sales.sales_date) = '2023'\n    GROUP BY\n        Products.product_name;\n\"\"\"\npd.read_sql(query, conn)\n\n\n\n\n\n  \n    \n      \n      product_name\n      total_quantity\n      quantity_rank\n    \n  \n  \n    \n      0\n      Washing machine\n      6.0\n      1\n    \n    \n      1\n      Laptop\n      5.0\n      2\n    \n    \n      2\n      Phone\n      NaN\n      3\n    \n  \n\n\n\n\n\n\nQ7\nWrite a query that categorizes customers into “New” (if they signed up in the last 6 months) or “Existing” based on their sign_up_date. Include the customer_name, region, and category in the result.\n\n\nCode\nquery = \"\"\"\n    SELECT DISTINCT\n        Customers.customer_name,\n        Customers.sales_region,\n    CASE\n        WHEN\n            Customers.sign_up_date &gt;= DATE('now', '-6 months')\n        THEN\n            'New'\n        ELSE\n            'Existing'\n    END AS customer_status\n    FROM\n        Customers\n    LEFT JOIN Sales\n        ON Customers.customer_id = Sales.customer_id\n\"\"\"\npd.read_sql(query, conn)\n\n\n\n\n\n  \n    \n      \n      customer_name\n      sales_region\n      customer_status\n    \n  \n  \n    \n      0\n      John Doe\n      West\n      Existing\n    \n    \n      1\n      Jane Young\n      South\n      New\n    \n    \n      2\n      Chris Nguyen\n      West\n      New\n    \n  \n\n\n\n\n\n\nQ8\nWrite a query to return the month and year along with the total sales for each month for the last 12 months."
  },
  {
    "objectID": "notebooks/sql_qs.html#wrapping-up",
    "href": "notebooks/sql_qs.html#wrapping-up",
    "title": "Exploring a database with SQL",
    "section": "Wrapping up",
    "text": "Wrapping up\n\n\nClose the database connection\ncursor.close()\nconn.close()"
  }
]